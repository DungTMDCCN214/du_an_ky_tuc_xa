<!-- dormitory/templates/dormitory/reports.html -->
{% extends 'base.html' %}

{% block title %}BÃ¡o cÃ¡o & Thá»‘ng kÃª{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>ğŸ“Š BÃ¡o cÃ¡o & Thá»‘ng kÃª</h1>
    <div>
        <div class="btn-group">
            <a href="{% url 'export_rooms_excel' %}" class="btn btn-outline-success">ğŸ“Š Xuáº¥t Excel</a>
            <a href="{% url 'export_rooms_pdf' %}" class="btn btn-outline-danger">ğŸ“„ Xuáº¥t PDF</a>
        </div>
        <button class="btn btn-success ms-2" onclick="window.print()">ğŸ–¨ï¸ In bÃ¡o cÃ¡o</button>
        <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary ms-2">ğŸ“Š Dashboard</a>
    </div>
</div>
<!-- THá»NG KÃŠ Tá»”NG QUAN -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card border-left-primary shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                            Tá»•ng phÃ²ng
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ room_stats.total }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-door-closed fa-2x text-gray-300">ğŸšª</i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                            PhÃ²ng trá»‘ng
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ room_stats.available }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-bed fa-2x text-gray-300">âœ…</i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                            Tá»· lá»‡ láº¥p Ä‘áº§y
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ room_stats.occupancy_percentage|floatformat:1 }}%
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-chart-pie fa-2x text-gray-300">ğŸ“ˆ</i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                            HÄ sáº¯p háº¿t háº¡n
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            {{ contract_stats.upcoming_expiry }}
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-clock fa-2x text-gray-300">â°</i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- BIá»‚U Äá»’ PHÃ‚N Bá» PHÃ’NG -->
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5>ğŸ“Š PhÃ¢n bá»‘ tráº¡ng thÃ¡i phÃ²ng</h5>
            </div>
            <div class="card-body">
                <div class="text-center">
                    <div class="row">
                        <div class="col-4">
                            <div class="text-success">
                                <h3>{{ room_stats.available }}</h3>
                                <small>âœ… CÃ²n trá»‘ng</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="text-danger">
                                <h3>{{ room_stats.occupied }}</h3>
                                <small>â›” ÄÃ£ thuÃª</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="text-warning">
                                <h3>{{ room_stats.maintenance }}</h3>
                                <small>ğŸ› ï¸ Báº£o trÃ¬</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5>ğŸ“ˆ Thá»‘ng kÃª há»£p Ä‘á»“ng</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-4">
                        <div class="text-success">
                            <h3>{{ contract_stats.active }}</h3>
                            <small>âœ… Äang hoáº¡t Ä‘á»™ng</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="text-danger">
                            <h3>{{ contract_stats.expired }}</h3>
                            <small>âŒ ÄÃ£ háº¿t háº¡n</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="text-warning">
                            <h3>{{ contract_stats.upcoming_expiry }}</h3>
                            <small>â° Sáº¯p háº¿t háº¡n</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- THá»NG KÃŠ THEO TÃ’A NHÃ€ -->
<div class="card mt-4">
    <div class="card-header bg-info text-white">
        <h5>ğŸ¢ Thá»‘ng kÃª theo tÃ²a nhÃ </h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>TÃ²a nhÃ </th>
                        <th>Tá»•ng phÃ²ng</th>
                        <th>PhÃ²ng Ä‘Ã£ thuÃª</th>
                        <th>Tá»· lá»‡ láº¥p Ä‘áº§y</th>
                        <th>PhÃ²ng trá»‘ng</th>
                    </tr>
                </thead>
                <tbody>
                    {% for building in building_stats %}
                    <tr>
                        <td><strong>{{ building.name }}</strong></td>
                        <td>{{ building.total_rooms }}</td>
                        <td>{{ building.occupied_rooms }}</td>
                        <td>
                            {% if building.total_rooms > 0 %}
                                <span class="badge bg-{% if building.occupancy_rate >= 80 %}danger{% else %}success{% endif %}">
                                    {{ building.occupancy_rate|floatformat:1 }}%
                                </span>
                            {% else %}
                                <span class="badge bg-secondary">0%</span>
                            {% endif %}
                        </td>
                        <td>{{ building.available_rooms }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- BÃO CÃO DOANH THU (Placeholder) -->
<div class="card mt-4">
    <div class="card-header bg-warning text-dark">
        <h5>ğŸ’° BÃ¡o cÃ¡o doanh thu (Coming Soon)</h5>
    </div>
    <div class="card-body">
        <p class="text-muted">TÃ­nh nÄƒng bÃ¡o cÃ¡o doanh thu sáº½ Ä‘Æ°á»£c cáº­p nháº­t trong phiÃªn báº£n tiáº¿p theo.</p>
        <ul>
            <li>ğŸ“… Doanh thu theo thÃ¡ng/quÃ½/nÄƒm</li>
            <li>ğŸ“Š Biá»ƒu Ä‘á»“ tÄƒng trÆ°á»Ÿng doanh thu</li>
            <li>ğŸ“ˆ PhÃ¢n tÃ­ch xu hÆ°á»›ng</li>
            <li>ğŸ“‹ BÃ¡o cÃ¡o chi tiáº¿t</li>
        </ul>
    </div>
</div>
{% endblock %}